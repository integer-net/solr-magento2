<?php
// @codingStandardsIgnoreFile
?>
<?php
/**
 * Template for filter items block
 *
 * @var \Magento\LayeredNavigation\Block\Navigation\FilterRenderer $block
 * @var \IntegerNet\Solr\Model\Search\Adapter\FilterItem[] $filterItems
 */
?>
<?php $filterItem = current($filterItems) ?>
<?php if ($filterItem->canUsePriceSlider()): ?>
    <?php $currencySymbol = $filterItem->getCurrencySymbol() ?>
    <?php $identifier = $filterItem->getFilterIdentifier() ?>
    <span class="filter-value" id="filter_value_<?php echo $identifier ?>">
        <?php echo $filterItem->getSelectedMinValueFormatted() ?>
        -
        <?php echo $filterItem->getSelectedMaxValueFormatted() ?>
    </span>
    <br><br>
    <div class="ui-slider-wrapper">
        <div class="filter-options-slider" id="filter_options_slider_<?php echo $identifier ?>"></div>
    </div>
    <a class="action"
       href="<?php echo $block->escapeUrl($filterItem->getPriceFilterUrlWithCurrentValues()) ?>"
       id="filter_link_<?php echo $identifier ?>">
        <span><?php echo __('Select') ?></span>
    </a>

    <script>
        require([
            'jquery',
            'jquery/ui',
            'jQueryUiSlider',
            'Magento_Catalog/js/price-utils'
        ], function ($, _ui, slider, priceUtils) {

            var valueContainer = $('#filter_value_<?php echo $identifier ?>');
            var filterLink = $('#filter_link_<?php echo $identifier ?>');
            var targetUrl = '<?php echo $block->escapeJsQuote($filterItem->getPriceFilterUrlWithPlaceholder()) ?>';

            $('#filter_options_slider_<?php echo $identifier ?>').slider({
                range: true,
                min: <?php echo $filterItem->getMinAvailableValue() ?>,
                max: <?php echo $filterItem->getMaxAvailableValue() ?>,
                values: [<?php echo $filterItem->getSelectedMinValue() ?>, <?php echo $filterItem->getSelectedMaxValue() ?>],
                slide: function (event, ui) {
                    var newUrl = targetUrl.replace('priceRange', ui.values[0] + '-' + ui.values[1]);
                    filterLink.attr('href', newUrl);
                    var newValueFormatted = priceUtils.formatPrice(ui.values[0])
                        + ' <?php echo $currencySymbol ?> - '
                        + priceUtils.formatPrice(ui.values[1])
                        + ' <?php echo $currencySymbol ?>';
                    valueContainer.html(newValueFormatted);
                }
            });
        });
    </script>
<?php else: ?>
    <ol class="items">
        <?php foreach ($filterItems as $filterItem): ?>
            <li class="item">
                <?php if ($filterItem->getCount() > 0): ?>
                    <a class="filter-options-link" href="<?php echo $block->escapeUrl($filterItem->getUrl()) ?>">
                        <label class="tickbox<?php if ($filterItem->isActive()): ?> tickbox--active<?php endif ?>"
                               for="">
                            <input class="tickbox__field" type="checkbox">
                        </label>
                        <?php /* @escapeNotVerified */
                        echo $filterItem->getLabel() ?>
                        <?php if ($this->helper('\Magento\Catalog\Helper\Data')->shouldDisplayProductCountOnLayer()): ?>
                            <span class="count"><?php /* @escapeNotVerified */
                                echo $filterItem->getCount() ?><span class="filter-count-label">
                        <?php if ($filterItem->getCount() == 1): ?><?php /* @escapeNotVerified */
                            echo __('item') ?><?php else: ?><?php /* @escapeNotVerified */
                            echo __('items') ?><?php endif; ?></span></span>
                        <?php endif; ?>
                    </a>

                <?php else: ?>
                    <?php /* @escapeNotVerified */
                    echo $filterItem->getLabel() ?>
                    <?php if ($this->helper('\Magento\Catalog\Helper\Data')->shouldDisplayProductCountOnLayer()): ?>
                        <span class="count"><?php /* @escapeNotVerified */
                            echo $filterItem->getCount() ?><span class="filter-count-label">
                        <?php if ($filterItem->getCount() == 1): ?><?php /* @escapeNotVerified */
                            echo __('item') ?><?php else: ?><?php /* @escapeNotVerified */
                            echo __('items') ?><?php endif; ?></span></span>
                    <?php endif; ?>
                <?php endif; ?>
            </li>
        <?php endforeach ?>
    </ol>

    <script type="custom">
    jQuery(document).ready(function(){
        var filter = jQuery('.filter-options-link');

        filter.each(function(){
            var element = jQuery(this);
            var tickbox = element.find('.tickbox');

            element.click(function(){
                tickbox.toggleClass('tickbox--active');
            })
        })
    })

    </script>
<?php endif; ?>
